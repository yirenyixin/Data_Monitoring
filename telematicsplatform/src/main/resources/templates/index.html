<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>智慧警务-交通大数据监控平台</title>
    <link rel="stylesheet" th:href="@{css/common.css}">
    <link rel="stylesheet" th:href="@{css/map.css}">
</head>
<body>
<div class="data">
    <div class="data-title">
        <div class="title-left fl"></div>
        <div class="title-center fl"></div>
        <div class="title-right fr"></div>
    </div>
    <div class="data-content">
        <div class="con-left fl">
            <div class="left-top">
                <div class="info">
                    <div class="info-title">实时统计</div>
                    <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                    <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                    <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                    <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                    <div class="info-main">
                        <div class="info-1">
                            <div class="info-img fl">
                                <img th:src="@{img/info-img-1.png}" alt="">
                            </div>
                            <div class="info-text fl">
                                <p>车辆总数(辆)</p>
                                <p id="CountNum">12,457</p>
                            </div>
                        </div>
                        <div class="info-2">
                            <div class="info-img fl">
                                <img th:src="@{img/info-img-2.png}" alt="">
                            </div>
                            <div class="info-text fl">
                                <p>当前在线数(辆)</p>
                                <p id="OnlineNum">12,457</p>
                            </div>
                        </div>
                        <div class="info-3">
                            <div class="info-img fl">
                                <img th:src="@{img/info-img-3.png}" alt="">
                            </div>
                            <div class="info-text fl">
                                <p>当前活跃数(辆)</p>
                                <p id="activeNum">12,457</p>
                            </div>
                        </div>
                        <div class="info-4">
                            <div class="info-img fl">
                                <img th:src="@{img/info-img-4.png}" alt="">
                            </div>
                            <div class="info-text fl">
                                <p>当前活跃率(%)</p>
                                <p id="liveness">83</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="top-bottom">
                    <div class="title"></div>
                    <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                    <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                    <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                    <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                    <div id="echarts_1" class="charts"></div>
                </div>
            </div>
            <div class="left-bottom">
                <div class="title"></div>
                <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                <div id="echarts_2" class="charts"></div>
            </div>
        </div>
        <div class="con-center fl">
            <div class="map-num">
                <p>实时行驶车辆(辆)</p>
                <div class="num" id="runningNum">
                    <span>1</span>
                    <span>,</span>
                    <span>2</span>
                    <span>3</span>
                    <span>4</span>
                    <span>,</span>
                    <span>5</span>
                    <span>6</span>
                    <span>7</span>
                </div>
            </div>
            <div class="cen-top" id="map"></div>
            <div class="cen-bottom">
                <div class="title"></div>
                <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                <div id="echarts_3" class="charts"></div>
            </div>
        </div>
        <div class="con-right fr">
            <div class="right-top">
                <div class="title">汽车故障统计</div>
                <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                <div id="echarts_5" class="charts"></div>
            </div>
            <div class="right-center">
                <div class="title">电池报警车辆统计</div>
                <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
                <div id="echarts_6" class="charts"></div>
            </div>
            <div class="right-bottom">
                <div class="title"></div>
                <img th:src="@{img/bj-1.png}" alt="" class="bj-1">
                <img th:src="@{img/bj-2.png}" alt="" class="bj-2">
                <img th:src="@{img/bj-3.png}" alt="" class="bj-3">
                <img th:src="@{img/bj-4.png}" alt="" class="bj-4">
            </div>
        </div>
    </div>
</div>
</body>
<script th:src="@{js/jquery-2.1.1.min.js}"></script>
<script th:src="@{js/echarts.min.js}"></script>
<script th:src="@{js/china.js}"></script>
<script th:src="@{js/echarts.js}"></script>
<script type="text/javascript" th:inline="javascript">
    var socket;
    if (typeof(WebSocket) == "undefined") {
        console.log("您的浏览器不支持WebSocket");
    } else {
        console.log("您的浏览器支持WebSocket");
        //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接
        var href = window.location.href;
        var arr = href.split(":");
        var ip = arr[1];
        var port = arr[2];
        socket = new WebSocket("ws://" + ip + ":" + port + "/websocket");
        //打开事件
        socket.onopen = function () {
            console.log("Socket 已打开");
        };
        //获得消息事件
        socket.onmessage = function (msg) {
            /********** begin **********/
                //1.获取 WebSocket 服务端推送过来的数据并将其转换成 JSON 对象并命名为 d
            var d = JSON.parse(msg.data);
            //2.从 JSON 对象 d 中获取carCount、onlineCount、activeCount、active 并将其分别替换 id 为 CountNum、OnlineNum、activeNum 的文本内容
            $("#CountNum").text(d.carCount);
            $("#OnlineNum").text(d.onlineCount);
            $("#activeNum").text(d.activeCount)
            $("#liveness").text(d.active)
            var runningNum = numberHandle(d.activeCount);
            $("#runningNum").html(runningNum)
            //3.汽车故障图表生成，创建一个存储4种故障类型数量的数组（fault4Count、fault3Count、fault2Count、fault1Count），调用 fault(Array arr) 函数生成图表
            var faultList = new Array(d.fault4Count, d.fault3Count, d.fault2Count, d.fault1Count)
            fault(faultList)
            //4.汽车电池警告图表生成，创建一个存储5种电池警告类型数量的数组（warning5Count、warning4Count、warning3Count、warning2Count，warning1Count），调用 warning(Array arr) 函数生成图表
            var warningList = new Array(d.warning5Count, d.warning4Count, d.warning3Count, d.warning2Count, d.warning1Count)
            warning(warningList)
            /********** end **********/
        };
        //关闭事件
        socket.onclose = function () {
            console.log("Socket已关闭");
        };
        //发生了错误事件
        socket.onerror = function () {
            alert("Socket发生了错误");
        }
    }
    function numberHandle(str) {
        var arr = str.split("");
        var result = "";
        for (var x = 0; x < arr.length; x++) {
            result += "<span>" + arr[x] + "</span>"
        }
        return result;
    }
    function fault(dataList) {
        var myChart = echarts.init(document.getElementById('echarts_5'));
        var xData = function () {
            var data = ['致命故障', '严重故障', '一般故障', '轻微故障'];
            return data;
        }();
        option = {
            tooltip: {
                show: "true",
                trigger: 'item',
                backgroundColor: 'rgba(0,0,0,0.4)', // 背景
                padding: [8, 10], //内边距
                // extraCssText: 'box-shadow: 0 0 3px rgba(255, 255, 255, 0.4);', //添加阴影
                formatter: function (params) {
                    if (params.seriesName != "") {
                        return params.name + ' ：  ' + params.value + ' 辆';
                    }
                },
            },
            grid: {
                borderWidth: 0,
                top: 20,
                bottom: 35,
                left: 55,
                right: 30,
                textStyle: {
                    color: "#fff"
                }
            },
            xAxis: [{
                type: 'category',
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#363e83',
                    }
                },
                axisLabel: {
                    inside: false,
                    textStyle: {
                        color: '#bac0c0',
                        fontWeight: 'normal',
                        fontSize: '12',
                    },
                },
                data: xData,
            }, {
                type: 'category',
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                splitArea: {
                    show: false
                },
                splitLine: {
                    show: false
                },
                data: xData,
            }],
            yAxis: {
                type: 'value',
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#32346c',
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: '#32346c ',
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#bac0c0',
                        fontWeight: 'normal',
                        fontSize: '12',
                    },
                    formatter: '{value}',
                },
            },
            series: [{
                type: 'bar',
                itemStyle: {
                    normal: {
                        show: true,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: '#00c0e9'
                        }, {
                            offset: 1,
                            color: '#3b73cf'
                        }]),
                        barBorderRadius: 50,
                        borderWidth: 0,
                    },
                    emphasis: {
                        shadowBlur: 15,
                        shadowColor: 'rgba(105,123, 214, 0.7)'
                    }
                },
                zlevel: 2,
                barWidth: '20%',
                data: dataList
            },
                {
                    name: '',
                    type: 'bar',
                    xAxisIndex: 1,
                    zlevel: 1,
                    itemStyle: {
                        normal: {
                            color: '#121847',
                            borderWidth: 0,
                            shadowBlur: {
                                shadowColor: 'rgba(255,255,255,0.31)',
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowOffsetY: 2,
                            },
                        }
                    },
                    barWidth: '20%'
                }
            ]
        };
        myChart.setOption(option);
        window.addEventListener("resize", function () {
            myChart.resize();
        });
    }
    function warning(dataList) {
        var myChart = echarts.init(document.getElementById('echarts_6'));
        var xData = function () {
            var data = ['房车', '旅行轿车', '轿跑车', '跑车', '敞篷车'];
            return data;
        }();
        option = {
            // backgroundColor: "#141f56",
            tooltip: {
                show: "true",
                trigger: 'item',
                backgroundColor: 'rgba(0,0,0,0.4)', // 背景
                padding: [8, 10], //内边距
                // extraCssText: 'box-shadow: 0 0 3px rgba(255, 255, 255, 0.4);', //添加阴影
                formatter: function (params) {
                    if (params.seriesName != "") {
                        return params.name + ' ：  ' + params.value + ' 辆';
                    }
                },
            },
            grid: {
                borderWidth: 0,
                top: 20,
                bottom: 35,
                left: 55,
                right: 30,
                textStyle: {
                    color: "#fff"
                }
            },
            xAxis: [{
                type: 'category',
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#363e83',
                    }
                },
                axisLabel: {
                    inside: false,
                    textStyle: {
                        color: '#bac0c0',
                        fontWeight: 'normal',
                        fontSize: '12',
                    },
                },
                data: xData,
            }, {
                type: 'category',
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    show: false
                },
                splitArea: {
                    show: false
                },
                splitLine: {
                    show: false
                },
                data: xData,
            }],
            yAxis: {
                type: 'value',
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#32346c',
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: '#32346c ',
                    }
                },
                axisLabel: {
                    textStyle: {
                        color: '#bac0c0',
                        fontWeight: 'normal',
                        fontSize: '12',
                    },
                    formatter: '{value}',
                },
            },
            series: [{
                type: 'bar',
                itemStyle: {
                    normal: {
                        show: true,
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                            offset: 0,
                            color: '#00c0e9'
                        }, {
                            offset: 1,
                            color: '#3b73cf'
                        }]),
                        barBorderRadius: 50,
                        borderWidth: 0,
                    },
                    emphasis: {
                        shadowBlur: 15,
                        shadowColor: 'rgba(105,123, 214, 0.7)'
                    }
                },
                zlevel: 2,
                barWidth: '20%',
                data: dataList,
            },
                {
                    name: '',
                    type: 'bar',
                    xAxisIndex: 1,
                    zlevel: 1,
                    itemStyle: {
                        normal: {
                            color: '#121847',
                            borderWidth: 0,
                            shadowBlur: {
                                shadowColor: 'rgba(255,255,255,0.31)',
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowOffsetY: 2,
                            },
                        }
                    },
                    barWidth: '20%'
                }
            ]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        window.addEventListener("resize", function () {
            myChart.resize();
        });
    }
</script>
</html>